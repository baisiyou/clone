# 🎙️ 语音聊天使用指南

## 什么是语音聊天？

语音聊天功能允许你：
- 上传语音样本，克隆他人的声音
- AI 会用克隆的声音进行语音回复
- 你可以听到 AI 的语音回复，而不仅仅是文字

---

## 📝 使用步骤

### 第一步：克隆一个声音

1. **准备音频文件**
   - 格式：MP3、WAV、M4A、WebM 等常见音频格式
   - 时长：建议 1-5 分钟的清晰录音
   - 质量：清晰的单人说话声音（避免背景噪音）
   - 大小：不超过 10MB

2. **上传音频文件**
   - 在左侧 "🎤 Clone Voice" 区域
   - 输入声音名称（可选，如"爸爸的声音"、"朋友的声音"）
   - 点击 "Choose File" 选择音频文件
   - 点击 "Start Cloning" 开始克隆

3. **等待克隆完成**
   - 处理通常需要几秒到几分钟
   - 成功后会在 "🎵 Available Voices" 列表中显示
   - 新克隆的声音会自动被选中

### 第二步：选择要使用的声音

1. **查看可用声音列表**
   - 在左侧 "🎵 Available Voices" 区域
   - 会显示所有可用的声音（包括克隆的声音和 ElevenLabs 预设声音）

2. **选择声音**
   - 点击你想要使用的声音卡片
   - 选中的声音会高亮显示

3. **确认已选择**
   - 聊天界面应该显示可以输入（不再显示 "Please clone a voice first..."）
   - 如果显示禁用状态，说明还没有选择声音

### 第三步：开始语音聊天

1. **发送消息**
   - 在聊天界面输入框输入你的消息
   - 点击 "Send" 按钮或按 Enter 键发送

2. **接收语音回复**
   - AI 会先用 Gemini 生成文字回复
   - 然后使用你选择的声音将文字转换为语音
   - 语音会自动播放

3. **重复播放语音**
   - 如果错过了语音，可以点击回复消息下方的 "🔊 Play" 按钮
   - 可以多次点击重复播放

---

## 🎯 功能说明

### 语音聊天 vs 文本聊天

- **语音聊天**（有语音回复）：
  - ✅ 需要选择一个声音
  - ✅ 发送消息后会收到语音回复
  - ✅ 可以点击 "🔊 Play" 重复播放

- **文本聊天**（仅文字回复）：
  - ✅ 不需要选择声音
  - ✅ 发送消息后只收到文字回复
  - ⚠️ 不会调用 ElevenLabs API，所以即使 API 密钥有问题也能正常工作

### 当前状态指示

- **聊天界面显示 "Please clone a voice first..."**
  - 说明还没有选择声音
  - 此时发送消息是文本聊天模式

- **聊天界面可以正常输入**
  - 说明已经选择了声音
  - 此时发送消息是语音聊天模式

---

## ⚠️ 常见问题

### Q: 为什么没有语音回复？

**可能原因：**
1. **没有选择声音**
   - 解决：在左侧 "Available Voices" 中选择一个声音

2. **ElevenLabs API 密钥无效**
   - 解决：检查 Render 环境变量中的 `ELEVENLABS_API_KEY` 是否正确
   - 更新为有效的 API 密钥

3. **语音合成失败**
   - 系统会自动降级为文本回复
   - 检查浏览器控制台的错误信息

### Q: 如何知道当前是语音模式还是文本模式？

- **语音模式**：已选择声音，发送消息后会收到语音回复
- **文本模式**：未选择声音，只收到文字回复

### Q: 可以使用多个声音吗？

- ✅ 可以克隆多个声音
- ✅ 可以随时切换使用不同的声音
- ✅ 每次发送消息时使用当前选中的声音

### Q: 语音回复需要多长时间？

- 取决于：
  1. AI 生成回复的时间（通常 1-3 秒）
  2. 语音合成的时间（通常 2-5 秒）
  3. 网络传输时间
- 总计：通常 5-10 秒左右

---

## 💡 使用技巧

### 1. 准备高质量的音频样本
- 清晰的单人说话
- 避免背景噪音
- 建议包含多种语调

### 2. 选择合适的声音
- 克隆的声音：更个性化
- 预设声音：质量更稳定

### 3. 测试语音效果
- 先发送短消息测试
- 检查语音质量是否满意
- 如果不满意，可以尝试其他声音

### 4. 管理声音
- 定期清理不需要的声音
- 克隆的声音会占用 ElevenLabs 配额
- 删除不需要的声音可以释放配额

---

## 🔧 技术说明

### 语音聊天流程

```
用户发送消息
    ↓
AI (Gemini) 生成文字回复
    ↓
ElevenLabs 将文字转换为语音（使用选中的声音）
    ↓
前端自动播放语音
    ↓
用户可以看到文字并听到语音
```

### 需要配置的 API 密钥

1. **ElevenLabs API 密钥**（必需）
   - 用于：声音克隆和语音合成
   - 配置位置：Render Dashboard → Environment → `ELEVENLABS_API_KEY`

2. **Google Gemini API 密钥**（必需）
   - 用于：AI 对话生成
   - 配置位置：Render Dashboard → Environment → `GOOGLE_AI_API_KEY`

---

## 📞 需要帮助？

如果遇到问题：
1. 检查浏览器控制台（F12）的错误信息
2. 检查 Render 日志
3. 确认 API 密钥是否正确配置
4. 参考 [TROUBLESHOOTING.md](./TROUBLESHOOTING.md)

---

**祝你使用愉快！** 🎉

